<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Globus-cli for file transfer – Various courses</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-960d9d362f81d399278ec3e29b622b37.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-e7f4145358ce1d0cd37d8d374dbb44f9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-960d9d362f81d399278ec3e29b622b37.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#advantages-of-globus-transfer-over-traditional-scpsftprsync" id="toc-advantages-of-globus-transfer-over-traditional-scpsftprsync" class="nav-link active" data-scroll-target="#advantages-of-globus-transfer-over-traditional-scpsftprsync">Advantages of Globus transfer over traditional <code>scp</code>/<code>sftp</code>/<code>rsync</code></a></li>
  <li><a href="#different-ways-to-use-globus" id="toc-different-ways-to-use-globus" class="nav-link" data-scroll-target="#different-ways-to-use-globus">Different ways to use Globus:</a></li>
  <li><a href="#install-globus-cli-tools" id="toc-install-globus-cli-tools" class="nav-link" data-scroll-target="#install-globus-cli-tools">Install Globus CLI tools</a>
  <ul class="collapse">
  <li><a href="#on-your-computer" id="toc-on-your-computer" class="nav-link" data-scroll-target="#on-your-computer">On your computer</a></li>
  <li><a href="#on-a-cluster" id="toc-on-a-cluster" class="nav-link" data-scroll-target="#on-a-cluster">On a cluster</a></li>
  </ul></li>
  <li><a href="#getting-help" id="toc-getting-help" class="nav-link" data-scroll-target="#getting-help">Getting help</a></li>
  <li><a href="#globus-terminology" id="toc-globus-terminology" class="nav-link" data-scroll-target="#globus-terminology">Globus terminology</a></li>
  <li><a href="#starting-up-and-authenticating" id="toc-starting-up-and-authenticating" class="nav-link" data-scroll-target="#starting-up-and-authenticating">Starting up and authenticating</a></li>
  <li><a href="#other-synchronous-blocking-commands" id="toc-other-synchronous-blocking-commands" class="nav-link" data-scroll-target="#other-synchronous-blocking-commands">Other synchronous (blocking) commands</a></li>
  <li><a href="#single-file-transfer" id="toc-single-file-transfer" class="nav-link" data-scroll-target="#single-file-transfer">Single file transfer</a>
  <ul class="collapse">
  <li><a href="#testing-within-the-tutorial-endpoint" id="toc-testing-within-the-tutorial-endpoint" class="nav-link" data-scroll-target="#testing-within-the-tutorial-endpoint">Testing within the tutorial endpoint</a></li>
  <li><a href="#transfer-a-tutorial-collection-file-to-fir" id="toc-transfer-a-tutorial-collection-file-to-fir" class="nav-link" data-scroll-target="#transfer-a-tutorial-collection-file-to-fir">Transfer a tutorial collection file to Fir</a></li>
  <li><a href="#transfer-a-large-8.1gb-file-from-fir-to-nibi" id="toc-transfer-a-large-8.1gb-file-from-fir-to-nibi" class="nav-link" data-scroll-target="#transfer-a-large-8.1gb-file-from-fir-to-nibi">Transfer a large (8.1GB) file from Fir to Nibi</a></li>
  </ul></li>
  <li><a href="#multiple-files" id="toc-multiple-files" class="nav-link" data-scroll-target="#multiple-files">Multiple files</a></li>
  <li><a href="#globus-connect-personal" id="toc-globus-connect-personal" class="nav-link" data-scroll-target="#globus-connect-personal">Globus Connect Personal</a>
  <ul class="collapse">
  <li><a href="#transfer-a-large-file-from-fir-to-my-laptop" id="toc-transfer-a-large-file-from-fir-to-my-laptop" class="nav-link" data-scroll-target="#transfer-a-large-file-from-fir-to-my-laptop">Transfer a large file from Fir to my laptop</a></li>
  </ul></li>
  <li><a href="#capturing-task-id" id="toc-capturing-task-id" class="nav-link" data-scroll-target="#capturing-task-id">Capturing task ID</a>
  <ul class="collapse">
  <li><a href="#option-1-capture-at-scheduling-time" id="toc-option-1-capture-at-scheduling-time" class="nav-link" data-scroll-target="#option-1-capture-at-scheduling-time">Option 1: Capture at scheduling time</a></li>
  <li><a href="#option-2-use-labels-to-filter-current-tasks" id="toc-option-2-use-labels-to-filter-current-tasks" class="nav-link" data-scroll-target="#option-2-use-labels-to-filter-current-tasks">Option 2: Use labels to filter current tasks</a></li>
  </ul></li>
  <li><a href="#automating-workflows" id="toc-automating-workflows" class="nav-link" data-scroll-target="#automating-workflows">Automating workflows</a></li>
  <li><a href="#syncing-directories" id="toc-syncing-directories" class="nav-link" data-scroll-target="#syncing-directories">Syncing directories</a></li>
  <li><a href="#running-globus-cli-on-a-cluster" id="toc-running-globus-cli-on-a-cluster" class="nav-link" data-scroll-target="#running-globus-cli-on-a-cluster">Running globus-cli on a cluster</a></li>
  <li><a href="#globus-sharing" id="toc-globus-sharing" class="nav-link" data-scroll-target="#globus-sharing">Globus sharing</a></li>
  <li><a href="#globus-flows" id="toc-globus-flows" class="nav-link" data-scroll-target="#globus-flows">Globus flows</a></li>
  <li><a href="#links" id="toc-links" class="nav-link" data-scroll-target="#links">Links</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Globus-cli for file transfer</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Thursday, October 14<sup>th</sup>, 2025</strong></p>
<!-- You can find this page at &nbsp; -->
<!-- <span style="font-size:1.8em;">https://folio.vastcloud.org/globus</span> -->
<p><strong>Abstract</strong>: Globus is a widely used platform for secure, reliable, and high-performance data transfer across research systems. While the web interface is intuitive and remains our primary recommendation for most users, the command-line interface (CLI) offers advanced capabilities for automation, scripting, and managing large-scale workflows. In this webinar, we will present the globus-cli tool, show how to authenticate and configure your environment, and demonstrate key commands for transferring, monitoring, and managing files between endpoints. You will also learn tips for integrating globus-cli into scripts for repeatable and efficient data movement.</p>
<section id="advantages-of-globus-transfer-over-traditional-scpsftprsync" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-globus-transfer-over-traditional-scpsftprsync">Advantages of Globus transfer over traditional <code>scp</code>/<code>sftp</code>/<code>rsync</code></h2>
<p>In April, we hosted a webinar <a href="https://training.westdri.ca/tools/rdm">“Introduction to Globus”</a>. Here is a quick recap of why you might choose Globus over traditional file transfer tools:</p>
<ol type="1">
<li><strong>Parallel, multi-stream transfers</strong>: Globus uses the GridFTP protocol with multiple TCP streams, tuning them for wide-area networks, which can dramatically outperform single-threaded <code>scp</code> or <code>sftp</code>. This makes it ideal for transferring large-scale (multi-GB and multi-PB) datasets where <code>scp</code>/<code>sftp</code> typically fail or crawl. In short, Globus will try to maximize bandwidth between any two endpoints.</li>
<li><strong>Automatic retrying and resuming</strong>: If a transfer is interrupted (network drop, machine reboot, etc), Globus resumes where it left off without user intervention.</li>
<li><strong>Checksum verification</strong>.</li>
<li>File <strong>transfer happens in the background</strong>, i.e.&nbsp;you can close your laptop and the transfer continues server-to-server, unlike with <code>scp</code>/<code>sftp</code> where the session must stay open.
<ul>
<li>you’ll get an email notification when a task completes or fails</li>
<li>can also check status with interactive commands</li>
</ul></li>
<li>Provides <strong>logs, progress tracking, notifications, and retry logic</strong> automatically.
<ul>
<li>many research institutions use Globus for secure, auditable data movement that meets funding agency or privacy requirements</li>
</ul></li>
<li>You can <strong>share data</strong> with collaborators who don’t have direct system accounts.</li>
</ol>
</section>
<section id="different-ways-to-use-globus" class="level2">
<h2 class="anchored" data-anchor-id="different-ways-to-use-globus">Different ways to use Globus:</h2>
<ol type="1">
<li>By default, Globus uses a Web-based interface to manage transfers via a web browser. However, this requires a lot of mouse clicking and sometimes navigating very large directory trees.</li>
<li>There is also a <a href="https://docs.globus.org/api/transfer" target="_blank">REST-style Application Programming Interface (API)</a> that supports submitting and monitoring file transfers and managing Globus Connect Personal collections. This could be used in scripting languages like Python and Ruby to integrate Globus into web portals. This is not covered in this presentation.</li>
<li>In this webinar we will focus on using Globus from the command line to automate your transfers with shell commands and scripts/functions.</li>
</ol>
<!-- There is also [Globus SDK for Python](https://globus-sdk-python.readthedocs.io) -- not covered in this -->
<!-- presentation. -->
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Files aren’t stored on Globus – they reside on the underlying filesystem. If you don’t intend to remove files from your directories, avoid deleting them through the Globus interface.</p>
</div>
</div>
</section>
<section id="install-globus-cli-tools" class="level2">
<h2 class="anchored" data-anchor-id="install-globus-cli-tools">Install Globus CLI tools</h2>
<section id="on-your-computer" class="level3">
<h3 class="anchored" data-anchor-id="on-your-computer">On your computer</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> venv ~/env-globus <span class="at">--python</span> 3.12   <span class="co"># create a new virtual environment</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/env-globus/bin/activate</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> pip install globus-cli</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">deactivate</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="on-a-cluster" class="level3">
<h3 class="anchored" data-anchor-id="on-a-cluster">On a cluster</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nibi</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> avail python                <span class="co"># several versions available</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load python/3.12.4</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv ~/env-globus        <span class="co"># install Python tools in your $HOME/env-globus</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/env-globus/bin/activate   <span class="co"># load the environment</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> pip install <span class="at">--upgrade</span> pip <span class="at">--no-index</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> pip install <span class="at">--no-index</span> globus_cli setuptools   <span class="co"># all these will go into your $HOME/env-globus</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">deactivate</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Updating on a cluster
</div>
</div>
<div class="callout-body-container callout-body">
<p>As of this moment, the default version of globus-cli on our clusters is slightly old, so some functionality mentioned today is not available there. Fortunately, you can upgrade globus-cli in place very easily:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/env-globus/bin/activate</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> version   <span class="co"># 3.2.0, latest is 3.38.0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> update</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
</section>
<section id="getting-help" class="level2">
<h2 class="anchored" data-anchor-id="getting-help">Getting help</h2>
<!-- Quality-of-life settings -->
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/env-globus/bin/activate</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">eval</span> <span class="st">"</span><span class="va">$(</span><span class="ex">globus</span> <span class="at">--bash-completer</span><span class="va">)</span><span class="st">"</span>   <span class="co"># enable tab completion in bash version 4.4 or newer</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> <span class="at">--help</span>             <span class="co"># or -h</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> <span class="op">&lt;</span>command<span class="op">&gt;</span> --help   <span class="co"># or -h</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="at">--help</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> <span class="at">--help</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> list-commands</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><a href="https://docs.globus.org/cli/reference" target="_blank">CLI reference</a> &nbsp;🡐&nbsp; index of all commands with detailed manual pages</li>
</ul>
</section>
<section id="globus-terminology" class="level2">
<h2 class="anchored" data-anchor-id="globus-terminology">Globus terminology</h2>
<ul>
<li><em>Endpoint</em> is a server or system where data can be transferred to/from, e.g.&nbsp;an HPC cluster or your own computer.</li>
<li><em>Collection</em> is a named access point to a specific directory or dataset on an endpoint, with its own permissions and sharing settings.</li>
</ul>
<p>Sometimes the two are used interchangeably as you can you can transfer data to/from both, but they mean different things.</p>
<p>There are two main types of collections:</p>
<ol type="1">
<li><em>Mapped collections</em> expose a specific directory for authenticated users on a multi-user system, e.g.&nbsp;your home folder on a cluster. You typically have read+write access to your own home/scratch/project directory mapped collection, but other Globus users don’t.</li>
<li><em>Guest collections</em> are shared subsets of mapped collections, can be shared with other Globus users without giving full system access. An example would be a subdirectory in your home directory on a cluster that you open for read (or maybe write) access to your collaborator.</li>
</ol>
</section>
<section id="starting-up-and-authenticating" class="level2">
<h2 class="anchored" data-anchor-id="starting-up-and-authenticating">Starting up and authenticating</h2>
<p>In Globus there are two levels of authentication.</p>
<ol type="1">
<li>First, you need to log in to Globus itself:</li>
</ol>
<!-- my primary identity is razoumov@computecanada.ca - it's not an email address -->
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> login   <span class="co"># log in to a Globus session through your browser</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> whoami</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> whoami <span class="at">--verbose</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> session show   <span class="co"># show all active sessions</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># globus logout   # might run this at some point if you no longer need Globus</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>One person can have multiple Globus accounts, e.g.&nbsp;one with the Alliance, one with Google, one directly with Globus ID.</p>
<ol start="2" type="1">
<li>Second, when you access an endpoint (e.g.&nbsp;<code>globus ls ...</code>, <code>globus transfer ...</code>) inside a session, you will need to give Globus permission to access that endpoint / filesystem on your behalf. Theoretically, these “consents” can be managed via <a href="https://auth.globus.org/consents" target="_blank">https://auth.globus.org/consents</a> where you can see and revoke them individually. In practice I find it somewhat difficult to tell which endpoint is which (since it does not name them!), so the only way I can effectively use this site is by removing all existing consents.</li>
</ol>
<p>Let’s see how consents work in practice. We define a couple of Globus tutorial collections through their IDs:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">T1</span><span class="op">=</span>6c54cade-bde5-45c1-bdea-f4bd71dba2cc   <span class="co"># provided by Globus</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">T2</span><span class="op">=</span>31ce9ba0-176d-45a5-add3-f37d233ba47d   <span class="co"># another mirror of the same collection</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$T1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If this is your first time accessing this collection after <code>globus login</code>, you will likely get <em>“The collection you are trying to access data on requires you to grant consent for the Globus CLI to access it”</em> along with a suggested command to run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> session consent <span class="op">&lt;</span>authentication_scope<span class="op">&gt;</span>   <span class="co"># opens a browser page</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$T1</span>                      <span class="co"># empty</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$T1</span>:/home/share/godata   <span class="co"># three small files</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- missing consent scope ... -->
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>From Globus manual
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>When the Globus CLI is used to interact with a collection, it may find that it has not been granted sufficient permissions to access the collection. In these cases, the CLI will prompt you to run a login command to grant it the necessary consent.</li>
<li>There are also other cases, such as strict authentication policies, in which the CLI dynamically discovers requirements which require a new login flow.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Infinite authentication loop
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sometimes you might get stuck in an infinite authentication loop. After having logged into Globus, when trying to list or transfer files, if you are missing that endpoint’s consent, Globus <strong>should tell you</strong> to run a very specific command <code>globus session consent &lt;authentication_scope&gt;</code>. Sometimes, if some Globus machinery behind the scenes is not updated properly, you might get instead:</p>
<pre><code>The resource you are trying to access requires you to re-authenticate with specific identities.
message: Missing required data_access consent
Please use "globus session update" to re-authenticate with specific identities</code></pre>
<p>If you follow this advice, you will get stuck in an infinite authentication loop. In my experience, waiting for a day or so should automatically resolve the problem. Alternatively, email us at globus@tech.alliancecan.ca to open a support ticket.</p>
</div>
</div>
</section>
<section id="other-synchronous-blocking-commands" class="level2">
<h2 class="anchored" data-anchor-id="other-synchronous-blocking-commands">Other synchronous (blocking) commands</h2>
<p><code>globus ls "$COLLECTION"</code> is an example of a blocking Globus command that waits for the completion of the task before exiting. Other blocking command examples are:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$T1</span>                      <span class="co"># empty: this is my own playground</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> mkdir <span class="va">$T1</span>:test              <span class="co"># create a new directory</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> mkdir <span class="va">$T1</span>:test/today        <span class="co"># create a subdirectory inside</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> rename <span class="va">$T1</span> test/today test/tomorrow   <span class="co"># diff from Unix</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                             <span class="co"># not moving files via Globus!</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$T1</span>:test</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> rename <span class="va">$T1</span> test/tomorrow tomorrow   <span class="co"># can move objects across directories</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$T1</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> rm <span class="at">--recursive</span> <span class="va">$T1</span>:test             <span class="co"># --recursive only needed when not empty</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> rm <span class="at">--recursive</span> <span class="va">$T1</span>:tomorrow</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$T1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>globus delete</code> is a non-blocking version of <code>globus rm</code>, with mostly the same flags.</p>
</div>
</div>
</section>
<section id="single-file-transfer" class="level2">
<h2 class="anchored" data-anchor-id="single-file-transfer">Single file transfer</h2>
<section id="testing-within-the-tutorial-endpoint" class="level3">
<h3 class="anchored" data-anchor-id="testing-within-the-tutorial-endpoint">Testing within the tutorial endpoint</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> mkdir <span class="va">$T1</span>:test</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$T1</span>:/home/share/godata   <span class="co"># file1.txt file2.txt file3.txt</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$T1</span>:/home/share/godata/file1.txt <span class="va">$T1</span>:test/file1.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>The most common error with globus-cli
</div>
</div>
<div class="callout-body-container callout-body">
<p>With <code>globus transfer</code> for a single file, it is very important to specify the full file path in the destination that includes the file name, not just the target directory. Without the file name, the transfer will eventually fail, after trying for 1 hour.</p>
</div>
</div>
<p>This command is non-blocking, i.e.&nbsp;it will exit back to the command prompt, while transfer will take place in the background. Note that you will receive an email when transfer is complete. If you want to block until transfer completion in the terminal, run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task wait <span class="op">&lt;</span>taskID_from_the_previous_line<span class="op">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="at">-l</span> <span class="va">$T1</span>:test</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> rm <span class="at">-r</span> <span class="va">$T1</span>:test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>globus ls</code> works on directories, not files, e.g.&nbsp;try running <code>globus ls $T1:test/file1.txt</code>. On the other hand, <code>globus transfer</code> works with both directories and files.</p>
</div>
</div>
</section>
<section id="transfer-a-tutorial-collection-file-to-fir" class="level3">
<h3 class="anchored" data-anchor-id="transfer-a-tutorial-collection-file-to-fir">Transfer a tutorial collection file to Fir</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint search alliance</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint search alliance <span class="kw">|</span> <span class="fu">grep</span> fir   <span class="co"># use the ID of alliancecan#fir-globus in the next line</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">FIR</span><span class="op">=</span>8dec4129-9ab4-451d-a45f-5b4b8471f7a3</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$FIR</span>   <span class="co"># might or might not have access; using a mapped collection</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> session consent <span class="st">'urn:globus:auth:scope:transfer.api.globus.org:all[*https://auth.globus.org/scopes/8dec4129-9ab4-451d-a45f-5b4b8471f7a3/data_access]'</span>   <span class="co"># select razoumov@computecanada.ca</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$FIR</span>           <span class="co"># should see my Fir home directory</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$FIR</span>:scratch   <span class="co"># using another mapped collection</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$T1</span>:/home/share/godata/file1.txt <span class="va">$FIR</span>:scratch</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task show <span class="op">&lt;</span>taskID_from_the_previous_line<span class="op">&gt;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task show <span class="op">&lt;</span>taskID_from_the_previous_line<span class="op">&gt;</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Status|Faults'</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task event-list <span class="at">--filter-errors</span> <span class="op">&lt;</span>taskID<span class="op">&gt;</span>       <span class="co"># shows the actual error</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task cancel <span class="op">&lt;</span>taskID<span class="op">&gt;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$T1</span>:/home/share/godata/file1.txt <span class="va">$FIR</span>:scratch/f1.txt</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task list <span class="at">--filter-status</span> ACTIVE   <span class="co"># show all my active tasks</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task wait <span class="op">&lt;</span>taskID<span class="op">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- globus endpoint show $FIR -->
<!-- globus endpoint show $T1 -->
</section>
<section id="transfer-a-large-8.1gb-file-from-fir-to-nibi" class="level3">
<h3 class="anchored" data-anchor-id="transfer-a-large-8.1gb-file-from-fir-to-nibi">Transfer a large (8.1GB) file from Fir to Nibi</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint search alliance <span class="kw">|</span> <span class="fu">grep</span> nibi</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">NIBI</span><span class="op">=</span>07baf15f-d7fd-4b6a-bf8a-5b5ef2e229d3</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">FIR</span><span class="op">=</span>8dec4129-9ab4-451d-a45f-5b4b8471f7a3</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$FIR</span>:projects/def-razoumov-ac/razoumov/ieeevis2017-clouds/2d_lonlat_20.nc <span class="va">$NIBI</span>:scratch/2d_lonlat_20.nc</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="at">-l</span> <span class="va">$NIBI</span>:scratch <span class="kw">|</span> <span class="fu">grep</span> 2d_lonlat_20.nc</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task show <span class="op">&lt;</span>taskID<span class="op">&gt;</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Status|Faults'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This command will fail if one or more endpoints require authentication. Fortunately, in this case you will be prompted to run the following command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> session consent <span class="op">&lt;</span>authentication_scope<span class="op">&gt;</span>   <span class="co"># in browser; select razoumov@computecanada.ca</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then you can rerun the transfer command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$FIR</span>:projects/def-razoumov-ac/razoumov/ieeevis2017-clouds/2d_lonlat_20.nc <span class="va">$NIBI</span>:scratch/2d_lonlat_20.nc</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task show <span class="op">&lt;</span>taskID<span class="op">&gt;</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Status|Faults'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="multiple-files" class="level2">
<h2 class="anchored" data-anchor-id="multiple-files">Multiple files</h2>
<p>Globus CLI does not support Unix shell wildmasks in the source path. However, there are several workarounds:</p>
<ol type="1">
<li><p>Pack your multiple files into an archive.</p></li>
<li><p>, copy a directory with a <code>--include</code> flag, e.g.&nbsp;this will copy only <code>*.sh</code> files:</p></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="at">--recursive</span> <span class="at">--include</span> <span class="st">'*.sh'</span> <span class="at">--exclude</span> <span class="st">'*'</span> <span class="va">$FIR</span>:syncHPC/testEGL/ <span class="va">$NIBI</span>:scratch</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><code>--include</code> requires <code>--recursive</code></li>
<li>in my tests, <code>--exclude '*'</code> is needed to make sure no other files are copied</li>
<li>you can specify many filters in a row, e.g.&nbsp;<code>--include '*.txt' --include '*.md'</code></li>
</ol>
</div>
</div>
<ol start="3" type="1">
<li>Alternatively, you can use <code>--batch</code> to list <strong>multiple specific files</strong> with their source and destination paths:</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a># store this as include.txt: a list of source paths followed by destination paths</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>alexWithUpdatedDriver.sh alexWithUpdatedDriver.sh</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>bartWithCorrection.sh bartWithCorrection.sh</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>test.sh test.sh   # Slurm scripting for testing</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$FIR</span>:syncHPC/testEGL/ <span class="va">$NIBI</span>:scratch <span class="at">--batch</span> include.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>With this approach, you can mix multiple paths in a single file, e.g.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>alexWithUpdatedDriver.sh a/alexWithUpdatedDriver.sh</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>bartWithCorrection.sh b/bartWithCorrection.sh</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>test.sh test.sh   # Slurm scripting for testing</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>would create the subdirectories <code>a/</code> and <code>b/</code> inside <code>~/tmp/</code> as part of the transfer.</p>
<p>You can also delete files in batch:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> delete <span class="st">"COLLECTION:path/"</span> <span class="at">--batch</span> delete.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="4" type="1">
<li>Finally, you can sync two directories – this is described in a separate section below.</li>
</ol>
</section>
<section id="globus-connect-personal" class="level2">
<h2 class="anchored" data-anchor-id="globus-connect-personal">Globus Connect Personal</h2>
<p>Globus Connect Personal (GCP) turns a local machine into a Globus endpoint. This way you can transfer files with Globus from/to your computer.</p>
<ol type="1">
<li>Download Globus Connect Personal from <a href="https://app.globus.org/collections/gcp" target="_blank">https://app.globus.org/collections/gcp</a>.</li>
<li>Install and run “Globus Connect Personal” application.</li>
<li>Click Log in, follow in the browser, create a unique name for your endpoint (I used <em>“alexrsfu”</em>), provide details, save, exit setup.</li>
<li>In the menu bar click Globus Connect Personal | Preferences…<br>
Access tab, specify directory access details<br>
Info tab | write down your Endpoint ID <!-- f81086c2-a870-11f0-bd08-027493648695 --></li>
<li>Continue running Globus Connect Personal in the background.</li>
</ol>
<section id="transfer-a-large-file-from-fir-to-my-laptop" class="level3">
<h3 class="anchored" data-anchor-id="transfer-a-large-file-from-fir-to-my-laptop">Transfer a large file from Fir to my laptop</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint search alexrsfu   <span class="co"># might take a while to refresh</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">FIR</span><span class="op">=</span>8dec4129-9ab4-451d-a45f-5b4b8471f7a3</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LAPTOP</span><span class="op">=</span>f81086c2-a870-11f0-bd08-027493648695</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$LAPTOP</span>:tmp       <span class="co"># my local files</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> ~/tmp                    <span class="co"># should be the same</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="at">-l</span> <span class="va">$FIR</span>:data/deepImpact</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="at">-l</span> <span class="va">$FIR</span>:data/deepImpact <span class="kw">|</span> <span class="fu">grep</span> yB31_oneblock_46521.vti   <span class="co"># pick one of the files (590MB in size)</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$FIR</span>:data/deepImpact/yB31_oneblock_46521.vti <span class="va">$LAPTOP</span>:tmp/   <span class="co"># won't succeed (destination != filename)</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task show <span class="op">&lt;</span>taskID<span class="op">&gt;</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Status|Faults'</span>   <span class="co"># shows that it's ACTIVE but there are some Faults</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task event-list <span class="at">--filter-errors</span> <span class="op">&lt;</span>taskID<span class="op">&gt;</span>       <span class="co"># shows the actual error</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task cancel <span class="op">&lt;</span>taskID<span class="op">&gt;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$FIR</span>:data/deepImpact/yB31_oneblock_46521.vti <span class="va">$LAPTOP</span>:tmp/46521.vti   <span class="co"># this one works great!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can create endpoints for any number of personal computers. However, transfer between two personal endpoints is not enabled by default. If you need this capability, please contact open a <a href="mailto:globus@tech.alliancecan.ca">Globs ticket</a> to set up a <strong>Globus Plus account</strong>.</p>
<!-- ## Troubleshooting -->
<!-- ```sh -->
<!-- globus task cancel f09b98dd-5778-11f0-8b04-02fa2a4031ab -->
<!-- globus transfer $T1:/home/share/godata/file1.txt $FIR:scratch/file1.txt   # restart -->
<!-- globus task list --filter-status ACTIVE -->
<!-- globus task show 44b6937d-5784-11f0-ad34-0affcfc1d1e5 | grep -E 'Status|Faults' -->
<!-- globus task event-list --filter-errors 44b6937d-5784-11f0-ad34-0affcfc1d1e5   # see error messages -->
<!-- ``` -->
</section>
</section>
<section id="capturing-task-id" class="level2">
<h2 class="anchored" data-anchor-id="capturing-task-id">Capturing task ID</h2>
<section id="option-1-capture-at-scheduling-time" class="level3">
<h3 class="anchored" data-anchor-id="option-1-capture-at-scheduling-time">Option 1: Capture at scheduling time</h3>
<p>Let’s copy a file from a Globus tutorial collection to Fir’s <code>/scratch</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">T1</span><span class="op">=</span>6c54cade-bde5-45c1-bdea-f4bd71dba2cc</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">FIR</span><span class="op">=</span>8dec4129-9ab4-451d-a45f-5b4b8471f7a3</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="va">taskid</span><span class="op">=</span><span class="va">$(</span><span class="ex">globus</span> transfer <span class="va">$T1</span>:/home/share/godata/file1.txt <span class="va">$FIR</span>:scratch/file1.txt <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"Task ID"</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'{print $3}'</span><span class="va">)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task show <span class="va">$taskid</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Status|Faults'</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task wait <span class="va">$taskid</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="option-2-use-labels-to-filter-current-tasks" class="level3">
<h3 class="anchored" data-anchor-id="option-2-use-labels-to-filter-current-tasks">Option 2: Use labels to filter current tasks</h3>
<ol type="1">
<li>assign a label to a Globus task</li>
<li>filter all your Globus tasks by this label</li>
<li>extract the taskID and use it for getting details on the task</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="va">label</span><span class="op">=</span><span class="st">"copying a Globus tutorial file"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="va">label</span><span class="op">=</span><span class="va">$RANDOM$RANDOM$RANDOM</span>   <span class="co"># labels don't have to be unique, but having a unique label helps</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="at">--label</span> <span class="va">$label</span> <span class="va">$T1</span>:/home/share/godata/file1.txt <span class="va">$FIR</span>:scratch/file1.txt</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="va">taskid</span><span class="op">=</span><span class="va">$(</span><span class="ex">globus</span> task list <span class="at">--filter-label</span> <span class="va">$label</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-1</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'{print $1}'</span><span class="va">)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task show <span class="va">$taskid</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Status|Faults'</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task wait <span class="va">$taskid</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="automating-workflows" class="level2">
<h2 class="anchored" data-anchor-id="automating-workflows">Automating workflows</h2>
<p>Using one of these two approaches to handle task IDs, you can create a shell script to automate Globus transfers. However, be aware that you may occasionally encounter authentication or other issues, so treat these scripts as a convenience rather than a fully reliable black box.</p>
<p>Everyone’s workflow is different, so there is no one-size-fits-all script for every purpose. Instead, here are a few interactive functions that simplify my own day-to-day Globus workflows: <code>gcp()</code>, <code>gshow()</code>, <code>gwait()</code>, <code>gerror()</code> and <code>gcancel()</code>.</p>
<p>The command <code>gcp</code>:</p>
<ol type="1">
<li>provides a <code>scp</code>-like syntax, where <code>source</code> and <code>dest</code> could be “fir”, “nibi”, “rorqual”, “trillium”, “laptop”</li>
<li>stores endpoint IDs (don’t need to define these separately)</li>
<li>checks if the source and destination extensions are the same &nbsp;⮕&nbsp; forces you to enter a valid file name in the destination (providing just a directory will result in failed transfer)</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> gcp()</span> <span class="kw">{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="va">$#</span> <span class="ot">-eq</span> 0 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"No arguments specified ... Usage: gcp source:/path/to/src/file.ext dest:/path/to/dest/file.ext"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">SRC</span><span class="op">=</span><span class="st">"</span><span class="va">${1</span><span class="op">%%</span>:<span class="pp">*</span><span class="va">}</span><span class="st">"</span>    <span class="co"># endpoint name before the colon in the 1st argument</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">DEST</span><span class="op">=</span><span class="st">"</span><span class="va">${2</span><span class="op">%%</span>:<span class="pp">*</span><span class="va">}</span><span class="st">"</span>   <span class="co"># endpoint name before the colon in the 2nd argument</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">PATH1</span><span class="op">=</span><span class="st">"</span><span class="va">${1</span><span class="op">#</span><span class="pp">*</span>:<span class="va">}</span><span class="st">"</span>   <span class="co"># file path after the colon in the 1st argument</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">PATH2</span><span class="op">=</span><span class="st">"</span><span class="va">${2</span><span class="op">#</span><span class="pp">*</span>:<span class="va">}</span><span class="st">"</span>   <span class="co"># file path after the colon in the 2nd argument</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="va">$SRC</span> <span class="va">$DEST</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename()</span> <span class="kw">{</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">SRC</span><span class="op">=</span><span class="st">"</span><span class="va">${1</span><span class="op">//</span><span class="va">$3</span><span class="op">/</span><span class="va">$4}</span><span class="st">"</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">DEST</span><span class="op">=</span><span class="st">"</span><span class="va">${2</span><span class="op">//</span><span class="va">$3</span><span class="op">/</span><span class="va">$4}</span><span class="st">"</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">rename</span> <span class="st">"</span><span class="va">$SRC</span><span class="st">"</span> <span class="st">"</span><span class="va">$DEST</span><span class="st">"</span> fir 8dec4129-9ab4-451d-a45f-5b4b8471f7a3</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">rename</span> <span class="st">"</span><span class="va">$SRC</span><span class="st">"</span> <span class="st">"</span><span class="va">$DEST</span><span class="st">"</span> nibi 07baf15f-d7fd-4b6a-bf8a-5b5ef2e229d3</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">rename</span> <span class="st">"</span><span class="va">$SRC</span><span class="st">"</span> <span class="st">"</span><span class="va">$DEST</span><span class="st">"</span> trillium ad462f99-8436-42b4-adc6-3644e36c1b67</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">rename</span> <span class="st">"</span><span class="va">$SRC</span><span class="st">"</span> <span class="st">"</span><span class="va">$DEST</span><span class="st">"</span> rorqual 93b2625f-a4ba-47ac-90d4-0bbb5ae19451</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">rename</span> <span class="st">"</span><span class="va">$SRC</span><span class="st">"</span> <span class="st">"</span><span class="va">$DEST</span><span class="st">"</span> laptop f81086c2-a870-11f0-bd08-027493648695</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extension()</span> <span class="kw">{</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="va">filename</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="st">"</span><span class="va">$filename</span><span class="st">"</span> <span class="ot">==</span> <span class="pp">*</span>.<span class="pp">*</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">extension</span><span class="op">=</span><span class="st">"</span><span class="va">${filename</span><span class="op">##</span><span class="pp">*</span>.<span class="va">}</span><span class="st">"</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">extension</span><span class="op">=</span><span class="st">""</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"</span><span class="va">$extension</span><span class="st">"</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="va">EXT1</span><span class="op">=</span><span class="va">$(</span><span class="ex">extension</span> <span class="st">"</span><span class="va">$PATH1</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="va">EXT2</span><span class="op">=</span><span class="va">$(</span><span class="ex">extension</span> <span class="st">"</span><span class="va">$PATH2</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="st">"</span><span class="va">$EXT1</span><span class="st">"</span> <span class="ot">!=</span> <span class="st">"</span><span class="va">$EXT2</span><span class="st">"</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Extension mismatch (</span><span class="va">$EXT1</span><span class="st"> and </span><span class="va">$EXT2</span><span class="st">) ... exiting"</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    <span class="ex">globus</span> transfer <span class="va">$SRC</span>:<span class="va">$PATH1</span> <span class="va">$DEST</span>:<span class="va">$PATH2</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> gshow()</span> <span class="kw">{</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="va">$#</span> <span class="ot">-eq</span> 0 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"No arguments specified ... Usage: gv &lt;taskID1&gt; &lt;taskID2&gt; ..."</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Therefore, showing all active tasks:"</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">globus</span> task list <span class="at">--filter-status</span> ACTIVE</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> task <span class="kw">in</span> <span class="va">$@</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    <span class="ex">globus</span> task show <span class="va">$task</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Status|Faults'</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> gwait()</span> <span class="kw">{</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    <span class="ex">globus</span> task wait <span class="va">$1</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> gerror()</span> <span class="kw">{</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>    <span class="ex">globus</span> task event-list <span class="at">--filter-errors</span> <span class="va">$1</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> gcancel()</span> <span class="kw">{</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>    <span class="ex">globus</span> task cancel <span class="va">$1</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>With these functions defined, the two earlier transfers can be written as:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcp</span> fir:projects/def-razoumov-ac/razoumov/ieeevis2017-clouds/2d_lonlat_20.nc nibi:scratch/2d_lonlat_20.nc</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gcp</span> fir:data/deepImpact/yB31_oneblock_46521.vti laptop:tmp/46521.vti</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gshow</span>                          <span class="co"># show all active tasks</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">gshow</span> taskID1 taskID2          <span class="co"># show details of these tasks</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ex">gwait</span> taskID1                  <span class="co"># block until taskID1 completes</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="syncing-directories" class="level2">
<h2 class="anchored" data-anchor-id="syncing-directories">Syncing directories</h2>
<p>Globus sync makes the destination match the source:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="at">--sync-level</span> <span class="op">&lt;</span>level<span class="op">&gt;</span> sourceEndpointID:/path/to/source/ destEndpointID:/path/to/dest/</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>where <code>&lt;level&gt;</code> is one of:</p>
<ul>
<li>exists &nbsp;→&nbsp; only send if destination file does not exist</li>
<li>size &nbsp;→&nbsp; send if size differs</li>
<li>mtime &nbsp;→&nbsp; send if modification time differs</li>
<li>checksum &nbsp;→&nbsp; compute checksums and send if they differ (slowest)</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Optional flag
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>--recursive</code> will include subdirectories.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Globus sync doesn’t delete extra files on the destination, i.e.&nbsp;there is no <code>rsync --delete</code> equivalent.</p>
</div>
</div>
<p>Here is a complete example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">FIR</span><span class="op">=</span>8dec4129-9ab4-451d-a45f-5b4b8471f7a3</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LAPTOP</span><span class="op">=</span>f81086c2-a870-11f0-bd08-027493648695</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/tmp   <span class="co"># no need to create ~/tmp/testEGL</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="at">--sync-level</span> size <span class="at">--recursive</span> <span class="va">$FIR</span>:syncHPC/testEGL/ <span class="va">$LAPTOP</span>:tmp/testEGL/</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To automate this, I would probably create a separate <code>gsync()</code> function.</p>
</section>
<section id="running-globus-cli-on-a-cluster" class="level2">
<h2 class="anchored" data-anchor-id="running-globus-cli-on-a-cluster">Running globus-cli on a cluster</h2>
<p>Refer to an earlier section to install globus-cli in a virtual environment on a cluster.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/env-globus/bin/activate   <span class="co"># load the environment</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> login    <span class="co"># log in by pasting the URL into a browser; copy the code back into the terminal</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> whoami   <span class="co"># returns razoumov@computecanada.ca</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint search alliance <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-e</span> fir <span class="at">-e</span> nibi</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">FIR</span><span class="op">=</span>8dec4129-9ab4-451d-a45f-5b4b8471f7a3</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">NIBI</span><span class="op">=</span>07baf15f-d7fd-4b6a-bf8a-5b5ef2e229d3</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$FIR</span>   <span class="co"># prompts to run the following command</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> session consent <span class="op">&lt;</span>authentication_scope<span class="op">&gt;</span>   <span class="co"># log in by pasting the URL into a browser; copy the code back</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="va">$FIR</span>   <span class="co"># works now!</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls <span class="at">-l</span> <span class="va">$FIR</span>:projects/def-razoumov-ac/razoumov/ieeevis2017-clouds <span class="kw">|</span> <span class="fu">grep</span> 2d_lonlat_20.nc   <span class="co"># 8.03GB</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$FIR</span>:projects/def-razoumov-ac/razoumov/ieeevis2017-clouds/2d_lonlat_20.nc <span class="va">$NIBI</span>:scratch/2d_lonlat_20.nc</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> task show 95ca1d32-9ee8-11f0-afcf-0e1cc5cf4f03 <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Status|Faults'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Interestingly, if you are running Globus Connect Personal on your machine which is behind the firewall, you can still initialize transfer to/from your computer on the cluster, which will never work with <code>scp</code>/<code>sftp</code>/<code>rsync</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LAPTOP</span><span class="op">=</span>f81086c2-a870-11f0-bd08-027493648695</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$NIBI</span>:data/mandelbulb800.nc <span class="va">$LAPTOP</span>:tmp/800.nc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="globus-sharing" class="level2">
<h2 class="anchored" data-anchor-id="globus-sharing">Globus sharing</h2>
<p>Globus sharing enables people to access files stored on your account on an Alliance cluster even if they don’t have an account on that system. You can find some Web interface-specific details in our documentation <a href="https://docs.alliancecan.ca/wiki/Globus#Globus_sharing" target="_blank">https://docs.alliancecan.ca/wiki/Globus#Globus_sharing</a>. You can share with individual Globus users and with groups. Here we’ll demo sharing with users.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Getting your collaborator’s Globus userID
</div>
</div>
<div class="callout-body-container callout-body">
<p>You will need your collaborator’s Globus userID to give them access. You can look it up yourself using their Globus username, e.g.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> get-identities razoumov@computecanada.ca</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or you can ask them for it. They can look it up via the web interface:</p>
<ol type="1">
<li>log in to https://globus.alliancecan.ca</li>
<li>Settings | Account | select Identity from the list | click the ↓ arrow to see your ID</li>
</ol>
<p>or in many different ways in the CLI:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> get-identities <span class="op">&lt;</span>collaboratorUserName<span class="op">&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> whoami <span class="at">--verbose</span> <span class="kw">|</span> <span class="fu">grep</span> ID</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> session show</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>E.g., when I run these commands myself, all three return the same useID. <!-- 32b4419f-e34a-433d-905d-61478c6cd7af --></p>
</div>
</div>
<p>To demo sharing, I will use my alternative Globus ID (log in via <a href="https://www.globus.org" class="uri">https://www.globus.org</a> and organization = Globus ID):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> get-identities razoumov@globusid.org                  <span class="co"># userName ⟹ userID</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> get-identities ae739fc4-d274-11e5-b957-ab0e5eadc80e   <span class="co"># userID ⟹ userName</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">COLLABORATOR</span><span class="op">=</span>ae739fc4-d274-11e5-b957-ab0e5eadc80e  <span class="co"># could be user or group ID</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">FIR</span><span class="op">=</span>8dec4129-9ab4-451d-a45f-5b4b8471f7a3</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Guest collections inside GCP
</div>
</div>
<div class="callout-body-container callout-body">
<p>Creating guest collections on a Globus Connect Personal mapped collection is supported, but it requires a paid subscription. Without it, you cannot share files hosted on your own computer. See the details <a href="https://docs.globus.org/api/transfer/gcp_management/#create_guest_collection" target="_blank">here</a>. However, you can host a guest collection on a Globus Connect Server mapped collection on an Alliance cluster where we already have a subscription.</p>
</div>
</div>
<p>You can share your files stored on an Alliance cluster with any Globus user in the world, even if that user does not have an account on that cluster.</p>
<ul>
<li><code>/home</code> – yes on all general-purpose clusters (not sure on Trillium)</li>
<li><code>/scratch</code> – yes on Beluga, Narval, Rorqual, no on other clusters</li>
<li><code>/project</code> – on PI’s request only (to prevent sharing other users’ files)</li>
</ul>
<p>Here we will create a guest collections on Fir’s <code>/home</code> and then we’ll share it with our collaborator.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Running this workflow on the cluster
</div>
</div>
<div class="callout-body-container callout-body">
<p>As of this moment, the default version of globus-cli on our clusters is slightly old, so the command <code>globus collection create ...</code> does not exist there. Therefore, you can either upgrade globus-cli in place yourself:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/env-globus/bin/activate</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> version   <span class="co"># 3.2.0, latest is 3.38.0</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> update</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or you can run this workflow on your own computer where presumably you have the latest version installed.</p>
</div>
</div>
<p>On Fir, let’s create <code>~/share</code> and place a file (e.g.&nbsp;<code>noise.silo</code>) there. In Globus, Fir is already registered as a Globus Connect Server v5 Mapped Collection, so you can create a new guest collection inside it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> collection create guest <span class="va">$FIR</span> /home/razoumov/share project004   <span class="co"># create a new guest collection</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>At this point Globus might ask you to run <code>globus login --gcs ...</code> to verify who you are, and then you can rerun the command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> collection create guest <span class="va">$FIR</span> /home/razoumov/share project004   <span class="co"># create a new guest collection</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Display Name:                     project004</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Owner:                            razoumov@computecanada.ca</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ID:                               2342c760-b98b-40cc-b3f7-9550dce48c83</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Collection Type:                  guest</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Public:                           True</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>“Public” means that anyone with a Globus account can search for this collection with <code>globus endpoint search project004</code>, but they cannot see the files inside it. For file access, give your collaborator permission (<code>r</code> or <code>rw</code>) to access your collection, e.g.&nbsp;at its root level (that will point to <code>~/share</code>):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="va">COLLECTION</span><span class="op">=</span>2342c760-b98b-40cc-b3f7-9550dce48c83</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint permission create <span class="at">--identity</span> <span class="va">$COLLABORATOR</span> <span class="at">--permissions</span> rw <span class="va">$COLLECTION</span>:/</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Message: Access rule created successfully.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rule ID: 228e0e90-a07f-11f0-b159-0affca67c55f</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If instead you want to share with all logged-in Globus users:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint permission create <span class="at">--permissions</span> r <span class="at">--all-authenticated</span> <span class="va">$COLLECTION</span>:/</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you want to share with anyone (no login needed):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint permission create <span class="at">--permissions</span> r <span class="at">--anonymous</span> <span class="va">$COLLECTION</span>:/</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- abc -->
<!-- --principal all_authenticated_users -->
<!-- Any logged-in Globus user -->
<!-- Works on all Guest Collections -->
<!-- --principal anonymous -->
<!-- Anyone with the link (no login) -->
<!-- Requires paid/subscribed mapped collection -->
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Keep the permission’s ruleID, as you will need it later to modify/revoke access.</p>
</div>
</div>
<p>At this point your collaborator should be able to see the files inside your collection:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint search project004   <span class="co"># if they have just the name =&gt; returns collectionID</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> ls 0a13e15f-4848-4b63-aa87-31202640eff4   <span class="co"># should see noise.silo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and transfer files (download with <code>r</code> and download/upload with <code>rw</code> permissions) with <code>globus transfer ...</code> or via the web interface.</p>
<p>Since this is your own collection, you should be able to use it as well, e.g.&nbsp;– after starting Globus Connect Personal – you can transfer files between this collection and your computer:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LAPTOP</span><span class="op">=</span>f81086c2-a870-11f0-bd08-027493648695</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$COLLECTION</span>:noise.silo <span class="va">$LAPTOP</span>:tmp/n.silo   <span class="co"># download a file</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span> <span class="op">&gt;</span> ~/tmp/test.txt</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> transfer <span class="va">$LAPTOP</span>:tmp/test.txt <span class="va">$COLLECTION</span>:/test.txt   <span class="co"># upload a file</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or, after adding “project004” to the <code>gcp()</code> shell function:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gcp</span> project004:noise.silo laptop:tmp/n.silo    <span class="co"># download a file</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gcp</span> laptop:tmp/test.txt project004:/test.txt   <span class="co"># upload a file</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>After your project is done, you might want to remove permissions:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint permission list <span class="va">$COLLECTION</span>   <span class="co"># show all permissions for this collection with ruleIDs</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> endpoint permission delete <span class="va">$COLLECTION</span> 228e0e90-a07f-11f0-b159-0affca67c55f   <span class="co"># collectionID ruleID</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and eventually delete the guest collection:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> collection delete <span class="va">$COLLECTION</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Delete order
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you delete the collection before removing its permissions, the permissions will get orphaned, and you will still see them listed (without ruleIDs) for any future collections created with the same shared directory – I don’t know how to delete these permissions in this case. Therefore, make sure to delete any associated permissions before deleting the collection.</p>
</div>
</div>
<!-- MARIE=9a894937-011d-4f84-a7cd-d4a79e114f47 -->
</section>
<section id="globus-flows" class="level2">
<h2 class="anchored" data-anchor-id="globus-flows">Globus flows</h2>
<p><em>Flow</em> is a series of steps that are performed in a specified order, e.g.&nbsp;you can run <code>tar</code>, delete files, add some other processing before / after transfer, share files, etc. A flow definition is a JSON document.</p>
<ul>
<li>how to create a flow <a href="https://docs.globus.org/guides/tutorials/flow-automation/create-a-flow" target="_blank">https://docs.globus.org/guides/tutorials/flow-automation/create-a-flow</a></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/tmp</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/globus/globus-flows-trigger-examples.git</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="ex">globus</span> flows create <span class="st">"My Transfer and Share Flow Example"</span> transfer_share/definition.json <span class="at">--input-schema</span> transfer_share/schema.json</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>their own example contains deprecated flow commands … someone needs to update the tutorial script</li>
<li>too advanced for this webinar</li>
</ul>
</section>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li><a href="https://docs.globus.org/cli" target="_blank">CLI front page</a></li>
<li><a href="https://docs.globus.org/cli/quickstart" target="_blank">CLI QuickStart Guide</a> &nbsp;🡐&nbsp; good starting point</li>
<li><a href="https://docs.globus.org/cli/examples" target="_blank">CLI examples</a> &nbsp;🡐&nbsp; nice examples</li>
<li><a href="https://docs.globus.org/faq">FAQ in all categories</a> &nbsp;🡐&nbsp; a must-read</li>
<li><a href="https://docs.globus.org/cli/reference" target="_blank">CLI reference</a> &nbsp;🡐&nbsp; index of all commands</li>
<li><a href="mailto:globus@tech.alliancecan.ca" target="_blank">Open a ticket</a> with any Globus issue on an Alliance system</li>
<li><a href="https://docs.globus.org/guides/overviews/high-assurance" target="_blank">High Assurance Collections for Protected Data</a> enable a subset of stricter security and compliance features
<ul>
<li>can enable MFA and other provider restriction for stricter endpoint access control</li>
<li>detailed logging and auditing</li>
<li>good for medical research institutions</li>
<li>separate commercial subscription tier at an extra cost</li>
<li>not covered today (except for Globus Connect Personal)</li>
</ul></li>
</ul>
<!-- ## Other topics and notes -->
<!-- bookmarks -->
<!-- ad462f99-8436-42b4-adc6-3644e36c1b67 | computecanada@globusid.org  | alliancecan#trillium -->
<!-- e9b2685e-f741-4c25-b857-2ec83ebb0f0c | computecanada@globusid.org  | alliancecan#trillium_home -->
<!-- b2759c38-0d00-455a-85c7-3523114e273e | computecanada@globusid.org  | alliancecan#trillium_project -->
<!-- a8016fc2-8688-45ae-98e0-4e517961d3e1 | computecanada@globusid.org  | alliancecan#trillium_scratch -->
<!-- 53fb2b74-f465-4dbf-8e9a-a1b01e442716 | computecanada@globusid.org  | alliancecan#trillium -->
<!-- difference between a collection and an endpoint -->
<!-- globus publish -->
<!-- globus groups -->
<!-- 1. login to Globus web interface -->
<!-- 2. Settings | Manage Your Consents -->
<!-- In the new architecture these two functions are cleanly separated with collections used for data access, and Globus Connect Server endpoints used for management. -->
<!---
```sh
fir
cd scratch
/bin/rm -rf f1.txt file1.txt noise.silo test.py
nibi
cd scratch/*
laptop
cd tmp
/bin/rm -rf 46521.vti testEGL 800.nc
```
-->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/folio\.vastcloud\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>
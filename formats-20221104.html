<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>What format to choose to save your data – Various courses</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-4df3b0c4fafa0f66eafcead0ee6cff11.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#links" id="toc-links" class="nav-link active" data-scroll-target="#links">Links</a></li>
  <li><a href="#requirements" id="toc-requirements" class="nav-link" data-scroll-target="#requirements">Requirements</a></li>
  <li><a href="#themes" id="toc-themes" class="nav-link" data-scroll-target="#themes">Themes</a></li>
  <li><a href="#remote-system" id="toc-remote-system" class="nav-link" data-scroll-target="#remote-system">Remote system</a></li>
  <li><a href="#python-packages" id="toc-python-packages" class="nav-link" data-scroll-target="#python-packages">Python packages</a></li>
  <li><a href="#csv" id="toc-csv" class="nav-link" data-scroll-target="#csv">CSV</a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json">JSON</a></li>
  <li><a href="#yaml" id="toc-yaml" class="nav-link" data-scroll-target="#yaml">YAML</a></li>
  <li><a href="#xml" id="toc-xml" class="nav-link" data-scroll-target="#xml">XML</a></li>
  <li><a href="#bson" id="toc-bson" class="nav-link" data-scroll-target="#bson">BSON</a></li>
  <li><a href="#netcdf-and-hdf5" id="toc-netcdf-and-hdf5" class="nav-link" data-scroll-target="#netcdf-and-hdf5">NetCDF (and HDF5)</a></li>
  <li><a href="#vtk-versatile-format-for-spatially-defined-data" id="toc-vtk-versatile-format-for-spatially-defined-data" class="nav-link" data-scroll-target="#vtk-versatile-format-for-spatially-defined-data">VTK = versatile format for spatially defined data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">What format to choose to save your data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Friday, November 4<sup>th</sup>, 2022, 1:00pm - 2:30pm</strong></p>
<p>You can find this page at &nbsp; <span style="font-size:1.8em;">https://folio.vastcloud.org/formats</span></p>
<p><strong>Abstract</strong>: Which file format should you use when saving your research dataset? Besides the obvious question of how to encode your data structures in a file, you might also want to consider portability (the ability to write/read data across different operating systems and different programming languages and libraries), the inclusion of metadata (data description), I/O bandwidth and file sizes, compression, and the ability to read/write data in parallel for large datasets. In this introductory in-person workshop, we will cover all these aspects starting from the very basic file formats and ending with scalable scientific dataset formats. We will cover CSV, JSON, YAML, XML, BSON, VTK, NetCDF, HDF5, using both structured and unstructured datasets and demoing all examples in Python.</p>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<ul>
<li>Fall 2022 training schedule: https://bit.ly/wg2022b</li>
<li>Research computing autumn in November: https://autumnschool2022.westdri.ca (free registration)</li>
<li>Training materials: https://training.westdri.ca (upcoming and archived events, ~100 recorded webinars)</li>
<li>Documentation: https://docs.alliancecan.ca</li>
<li>Email: training “at” westdri “dot” ca</li>
</ul>
</section>
<section id="requirements" class="level2">
<h2 class="anchored" data-anchor-id="requirements">Requirements</h2>
<p>In the demos we will use Python and quite a few Python libraries to write into all these file formats. If you are comfortable with running Python and installing Python libraries on your computer, we will mention the libraries as we go during the workshop. For everyone else, we will provide access to a remote system with all these libraries installed – all you’ll need is a browser.</p>
</section>
<section id="themes" class="level2">
<h2 class="anchored" data-anchor-id="themes">Themes</h2>
<ul>
<li><strong>Main theme</strong>:&nbsp; tabular data &nbsp;⮕&nbsp; Python data structures (hierarchical dictionaries) &nbsp;⮕&nbsp; large arrays</li>
<li><strong>Parallel theme</strong>:&nbsp; ASCII &nbsp;⮕&nbsp; binary &nbsp;⮕&nbsp; scientific formats with metadata, compression, parallel I/O</li>
<li><strong>Also to consider</strong>:&nbsp; file sizes, bandwidth (I/O speed), portability</li>
</ul>
</section>
<section id="remote-system" class="level2">
<h2 class="anchored" data-anchor-id="remote-system">Remote system</h2>
<p>Log in to the remote system and copy the workshop files into your home directory:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /home/user19/shared/formats/<span class="dt">{jeopardy.csv</span><span class="op">,</span><span class="dt">mandelbulb300.nc</span><span class="op">,</span><span class="dt">writeNodesEdges.py}</span> .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In a Python notebook in our JupyterHub, use:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">!cp</span> /home/user19/shared/formats/<span class="dt">{jeopardy.csv</span><span class="op">,</span><span class="dt">mandelbulb300.nc</span><span class="op">,</span><span class="dt">writeNodesEdges.py}</span> .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="python-packages" class="level2">
<h2 class="anchored" data-anchor-id="python-packages">Python packages</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pyyaml bson dict2xml pickle netCDF4 networkx numpy pandas xarray vtk pyevtk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="csv" class="level2">
<h2 class="anchored" data-anchor-id="csv">CSV</h2>
<ul>
<li>tabular data, such as a spreadsheet or database</li>
<li>ASCII format &nbsp;⇨&nbsp; good for small datasets</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"jeopardy.csv"</span>  <span class="co"># from https://domohelp.domo.com/hc/en-us/articles/360043931814-Fun-Sample-DataSets</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'r'</span>) <span class="im">as</span> csvfile:  <span class="co"># open the CSV file in READ mode</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    csvreader <span class="op">=</span> csv.reader(csvfile)   <span class="co"># create a CSV reader iterator</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    fields <span class="op">=</span> <span class="bu">next</span>(csvreader)          <span class="co"># extract first row; advance the iterator to the next row</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> csvreader:             <span class="co"># extract each row one by one</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        rows.append(row)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"total number of rows:"</span>, <span class="bu">len</span>(rows))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"field names are:"</span>, fields)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> rows[:<span class="dv">5</span>]:   <span class="co"># print first 5 rows</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> rows[<span class="dv">0</span>]:    <span class="co"># cycle through the first-row columns</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(col)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"short.csv"</span>, <span class="st">'w'</span>) <span class="im">as</span> csvfile:</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    csvwriter <span class="op">=</span> csv.writer(csvfile)   <span class="co"># create a CSV writer object</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    csvwriter.writerow(fields)        <span class="co"># write the fields</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    csvwriter.writerows(rows[:<span class="dv">10</span>])    <span class="co"># write the data rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There is alternative syntax:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>csvfile <span class="op">=</span> <span class="bu">open</span>(<span class="st">"short.csv"</span>, <span class="st">'w'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>csvwriter <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>csvwriter.writerow(fields)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>csvwriter.writerows(rows[:<span class="dv">10</span>])</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>csvfile.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s now use pandas dataframes for processing our rows and columns:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"jeopardy.csv"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>data.shape   <span class="co"># 216930 rows, 7 columns</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>)   <span class="co"># first 10 rows</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>data.columns    <span class="co"># names of the columns</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'Category'</span>]<span class="op">==</span><span class="st">'HISTORY'</span>].shape   <span class="co"># 349 matches</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'Category'</span>]<span class="op">==</span><span class="st">'HISTORY'</span>].to_csv(<span class="st">"history.csv"</span>)   <span class="co"># write to a file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Simple Python dictionaries can be stored as 2-column tables. Here is an example of writing a Python dictionary to CSV:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>centres <span class="op">=</span> {<span class="st">'Vancouver'</span>: <span class="dv">2463</span>, <span class="st">'Calgary'</span>: <span class="dv">1393</span>, <span class="st">'Toronto'</span>: <span class="dv">5928</span>, <span class="st">'Montreal'</span>: <span class="dv">4099</span>, <span class="st">'Halifax'</span>: <span class="dv">413</span>} <span class="co"># Python dictionary</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'cities.csv'</span>, <span class="st">'w'</span>) <span class="im">as</span> f:   <span class="co"># open a stream for writing</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> centres.keys():</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        f.write(<span class="st">"</span><span class="sc">%s</span><span class="st">, </span><span class="sc">%s</span><span class="ch">\n</span><span class="st">"</span> <span class="op">%</span> (key, centres[key]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise Header
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Modify the last Python script to add a header “city, population” to this CSV file.</p>
</div>
</div>
</div>
<!-- > Add `f.write("city, population\n")` before the `for` loop. -->
<p>How about a more complex Python dictionary, with some hierarchical structure? For that a CSV file won’t work, but you can use JSON files.</p>
</section>
<section id="json" class="level2">
<h2 class="anchored" data-anchor-id="json">JSON</h2>
<ul>
<li>JavaScript Object Notation, inspired by JavaScript object literal syntax, although not part of JavaScript</li>
<li>human-readable text, although can contain non-ASCII characters</li>
<li>very popular for encoding all sorts of data among web developers</li>
<li>internal mapping is similar to that of a Python dictionary, with key-value pairs</li>
</ul>
<p>Let’s start again with a simple dictionary:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>centres <span class="op">=</span> {<span class="st">'Vancouver'</span>: <span class="dv">2463</span>, <span class="st">'Calgary'</span>: <span class="dv">1393</span>, <span class="st">'Toronto'</span>: <span class="dv">5928</span>, <span class="st">'Montreal'</span>: <span class="dv">4099</span>, <span class="st">'Halifax'</span>: <span class="dv">413</span>} <span class="co"># Python dictionary</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> json.dumps(centres)      <span class="co"># convert it to a JSON string</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(y)                      <span class="co"># it is string, as far as Python is concerned</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>json.loads(y)[<span class="st">"Vancouver"</span>]   <span class="co"># back to a Python dictionary that we can subset</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(json.loads(y))          <span class="co"># it is really a dictionary</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># convert more complex Python object to a JSON string</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="st">'something'</span>, {<span class="st">'more'</span>: (<span class="st">'complex'</span>, <span class="va">None</span>, <span class="fl">1.0</span>, <span class="dv">2</span>)}]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>json.dumps(a)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># can use custom separators</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>json.dumps(a, separators<span class="op">=</span>(<span class="st">"; "</span>, <span class="st">" &gt; "</span>), sort_keys<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can convert into JSON strings the following Python objects: <em>int, float, string, logical, tuple, list, dict, None</em>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"name"</span>: <span class="st">"John"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"age"</span>: <span class="dv">30</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"married"</span>: <span class="va">True</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"divorced"</span>: <span class="va">False</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"children"</span>: (<span class="st">"Ann"</span>,<span class="st">"Billy"</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pets"</span>: <span class="va">None</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cars"</span>: [</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"model"</span>: <span class="st">"BMW 230"</span>, <span class="st">"mpg"</span>: <span class="fl">27.5</span>},</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"model"</span>: <span class="st">"Ford Edge"</span>, <span class="st">"mpg"</span>: <span class="fl">24.1</span>}</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>jstring <span class="op">=</span> json.dumps(x)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(jstring)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># write the string to a file</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'personal.json'</span>, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    f.write(jstring)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># read the file</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'personal.json'</span>, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> f.read()</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data)             <span class="co"># it is a (JSON) string</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> json.loads(data)   <span class="co"># convert to a dictionary</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>g[<span class="st">"name"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise Open-close
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Convert the last write operation from a stream to an “open-close” block.</p>
</div>
</div>
</div>
<!-- ```py -->
<!-- f = open('personal.json', 'w') -->
<!-- f.write(jstring) -->
<!-- f.close() -->
<!-- ``` -->
<p>You can also write the dictionary directly to a file, without creating a JSON string:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'personal.json'</span>, <span class="st">'w'</span>) <span class="im">as</span> outfile:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    json.dump(x, outfile)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'personal.json'</span>) <span class="im">as</span> <span class="bu">file</span>:   <span class="co"># read from a file into a dictionary</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> json.load(<span class="bu">file</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To summarize:</p>
<ul>
<li><code>json.dumps()</code> converts a Python object to a JSON string</li>
<li><code>json.loads()</code> converts a JSON string to a Python object</li>
<li><code>json.dump()</code> writes a Python object to a stream as a JSON string</li>
<li><code>json.load()</code> loads a Python object from a JSON string stream</li>
</ul>
<p>Finally, let’s write a large multidimensional numpy array into JSON. The converter <code>json.dumps()</code> is not aware of the numpy data format. If you try to run <code>f.write(json.dumps(x))</code>, you will receive <em>“TypeError: Object of type ndarray is not JSON serializable”.</em> However, you can convert this array to a list:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.zeros((<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">100</span>), dtype<span class="op">=</span>np.float32)   <span class="co"># allocate single-precision 100^3 array</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>x[:] <span class="op">=</span> np.random.random(size<span class="op">=</span>x.shape)   <span class="co"># fill it with random numbers drawn from a uniform [0,1) distribution</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>x.dtype   <span class="co"># single precision</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>x.shape   <span class="co"># (100, 100, 100)</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"array.json"</span>, <span class="st">'w'</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>f.write(json.dumps(x.tolist()))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>f.close()   <span class="co"># the new file is 20,289,659 bytes - remember this number</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To read it:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"array.json"</span>, <span class="st">'r'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> f.read()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> json.loads(data)   <span class="co"># convert to a nested list</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(b)        <span class="co"># it is a list</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(b)         <span class="co"># it has 100 elements (2D slices)</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(b[<span class="dv">0</span>])      <span class="co"># of which the first element also has 100 elements (1D columns)</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(b[<span class="dv">0</span>][<span class="dv">0</span>])   <span class="co"># of which the first element also has 100 elements (individual numbers)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="yaml" class="level2">
<h2 class="anchored" data-anchor-id="yaml">YAML</h2>
<ul>
<li>stands for YAML Ain’t Markup Language</li>
<li>uses indentation to define structured data</li>
<li>often used as a format for configuration files</li>
<li>simpler replacement for the JSON format</li>
<li>https://www.cloudbees.com/blog/yaml-tutorial-everything-you-need-get-started</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pyyaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"name"</span>: <span class="st">"John"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"age"</span>: <span class="dv">30</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"married"</span>: <span class="va">True</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"divorced"</span>: <span class="va">False</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"children"</span>: (<span class="st">"Ann"</span>,<span class="st">"Billy"</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pets"</span>: <span class="va">None</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cars"</span>: [</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"model"</span>: <span class="st">"BMW 230"</span>, <span class="st">"mpg"</span>: <span class="fl">27.5</span>},</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"model"</span>: <span class="st">"Ford Edge"</span>, <span class="st">"mpg"</span>: <span class="fl">24.1</span>}</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>yaml.dump(x)                            <span class="co"># dump to the terminal</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'personal.yaml'</span>, <span class="st">'w'</span>) <span class="im">as</span> f:   <span class="co"># write to a file</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    yaml.dump(x, f, sort_keys<span class="op">=</span><span class="va">False</span>, default_flow_style<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Setting <code>default_flow_style=True</code> would give you a more compact notation with separators, but it’ll be more difficult to read with a naked eye.</p>
<p>Let’s now read it. There are different readers (“loaders”) ordered by their security level:</p>
<ul>
<li><code>BaseLoader</code> loads all the basic YAML scalars as strings</li>
<li><code>SafeLoader</code> loads subset of the YAML safely, mainly used if the input is from an untrusted source; cannot deal with Python tuples</li>
<li><code>FullLoader</code> loads the full YAML but avoids arbitrary code execution; still poses a potential risk when used for the untrusted input</li>
<li><code>UnsafeLoader</code> is the original loader, generally used for backward compatibility</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> yaml.loader <span class="im">import</span> FullLoader</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'personal.yaml'</span>) <span class="im">as</span> f:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> yaml.load(f, Loader<span class="op">=</span>FullLoader)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s try writing 2 documents into a YAML file:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> {<span class="st">'this'</span>: <span class="dv">77</span>, <span class="st">'there'</span>: <span class="dv">45</span>, <span class="st">'hi'</span>: <span class="dv">10</span>, <span class="st">'at'</span>: <span class="dv">23</span>, <span class="st">'Hello'</span>: <span class="dv">7</span>}</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'personal.yaml'</span>, <span class="st">'w'</span>) <span class="im">as</span> f:   <span class="co"># write to a file</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> yaml.dump_all([x,x2], f, sort_keys<span class="op">=</span><span class="va">False</span>, default_flow_style<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can read them with:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> yaml.loader <span class="im">import</span> FullLoader</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'personal.yaml'</span>, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">list</span>(yaml.load_all(f, Loader<span class="op">=</span>FullLoader))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(data))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="xml" class="level2">
<h2 class="anchored" data-anchor-id="xml">XML</h2>
<ul>
<li>eXtensible Markup Language</li>
<li>uses a tag to define the structure, just like HTML</li>
<li>3rd popular serialization format https://www.csestack.org/yaml-vs-json-vs-xml-difference</li>
<li>write/read XML from Python
<ul>
<li>https://stackabuse.com/reading-and-writing-xml-files-in-python</li>
<li>https://www.geeksforgeeks.org/serialize-python-dictionary-to-xml</li>
</ul></li>
</ul>
<p>Here let’s consider only a quick write example:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install xml-python</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> ET.Element(<span class="st">'data'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> ET.SubElement(data, <span class="st">'items'</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>item1 <span class="op">=</span> ET.SubElement(items, <span class="st">'item'</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>item2 <span class="op">=</span> ET.SubElement(items, <span class="st">'item'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>item1.<span class="bu">set</span>(<span class="st">'name'</span>,<span class="st">'item1'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>item2.<span class="bu">set</span>(<span class="st">'name'</span>,<span class="st">'item2'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>item1.text <span class="op">=</span> <span class="st">'item1-some-text'</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>item2.text <span class="op">=</span> <span class="st">'item2-some-text'</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>mydata <span class="op">=</span> ET.tostring(data)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(mydata)                        <span class="co"># it is a `bytes` object</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>myfile <span class="op">=</span> <span class="bu">open</span>(<span class="st">"items.xml"</span>, <span class="st">"wb"</span>)   <span class="co"># write it into a string</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>myfile.write(mydata)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>myfile.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install dict2xml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dict2xml <span class="im">import</span> dict2xml</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"name"</span>: <span class="st">"John"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"age"</span>: <span class="dv">30</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"married"</span>: <span class="va">True</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"divorced"</span>: <span class="va">False</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"children"</span>: (<span class="st">"Ann"</span>,<span class="st">"Billy"</span>),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pets"</span>: <span class="va">None</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cars"</span>: [</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"model"</span>: <span class="st">"BMW 230"</span>, <span class="st">"mpg"</span>: <span class="fl">27.5</span>},</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"model"</span>: <span class="st">"Ford Edge"</span>, <span class="st">"mpg"</span>: <span class="fl">24.1</span>}</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>xml <span class="op">=</span> dict2xml(x)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xml)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>myfile <span class="op">=</span> <span class="bu">open</span>(<span class="st">"personal.xml"</span>, <span class="st">"w"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>myfile.write(xml)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>myfile.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bson" class="level2">
<h2 class="anchored" data-anchor-id="bson">BSON</h2>
<ul>
<li>binary Javascript Object Notation, i.e.&nbsp;binary-encoded serialization of JSON documents</li>
<li>data storage, main format for MongoDB</li>
<li>can even send/receive BSON objects over network sockets from Python</li>
<li>used heavily for sending/receiving data in web development</li>
<li>a list of ordered elements containing a field name, type, and value</li>
<li>maximum structure size is 2GB (not very good …)</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install bson</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It is very easy to write into BSON files:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bson</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> {<span class="st">"a"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="st">"6"</span>, {<span class="st">"some"</span>: <span class="st">"text"</span>}]}</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> bson.dumps(x)   <span class="co"># convert dictionary -&gt; BSON object (string of binary codes)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"test.bson"</span>, <span class="st">'wb'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>f.write(a)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>f.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Reading is a reverse process:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bson</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"test.bson"</span>, <span class="st">'rb'</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> f.read()    <span class="co"># read a BSON string</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>bson.loads(data)   <span class="co"># extract our dictionary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s consider a larger numpy array. If you try to pass it via a dictionary value to BSON, it’ll crash with an error, as BSON library is not smart enough to understand a numpy array wrapped into a dictionary. However, you can encode this numpy array into a byte stream with a numpy-aware <code>pickle</code> library (https://docs.python.org/3/library/pickle.html):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.zeros((<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">100</span>), dtype<span class="op">=</span>np.float32)   <span class="co"># allocate single-precision 100^3 array</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>x[:] <span class="op">=</span> np.random.random(size<span class="op">=</span>x.shape)   <span class="co"># fill it with random numbers drawn from a uniform [0,1) distribution</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>x.dtype   <span class="co"># single precision</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle   <span class="co"># binary protocols for serializing (converting into a byte stream) and de-serializing Python object structures</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bson</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> {<span class="st">"random"</span>: pickle.dumps(x)}</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"array.bson"</span>, <span class="st">'wb'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>f.write(bson.dumps(table))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>f.close()   <span class="co"># the new file is 4,000,181 bytes - compare this to an earlier JSON example (20 MB)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note: For those wondering if we could convert a “pickled” numpy array to BSON, without using a dictionary, e.g.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>xstream <span class="op">=</span> pickle.dumps(x)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>bson.dumps(xstream)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>the answer is “no”, as the second command would produce <em>“AttributeError: ‘bytes’ object has no attribute ‘keys’”</em>, i.e.&nbsp;<code>bson.dumps()</code> expects a dictionary.</p>
</div>
</div>
<p>Now, let’s read from BSON:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle, bson</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"array.bson"</span>, <span class="st">'rb'</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> f.read()</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>newTable <span class="op">=</span> bson.loads(data)            <span class="co"># convert BSON -&gt; dictionary</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> pickle.loads(newTable[<span class="st">"random"</span>])   <span class="co"># de-serialize the value back into a numpy array</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(b)   <span class="co"># numpy array</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>b.dtype   <span class="co"># single precision</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!-- This creates a file with approximately 8+8=16 bytes per key-value pair, as both numbers are stored in double -->
<!-- precision. Compare this to JSON that produces a text file 2X the size: -->
<!-- ```py -->
<!-- import json -->
<!-- with open("logTable.json", 'w') as f: -->
<!--     f.write(json.dumps(logTable)) -->
<!-- ``` -->
<!-- Now, let's read from BSON: -->
<!-- ```py -->
<!-- import bson -->
<!-- f = open("logTable.bson", 'rb') -->
<!-- data = f.read() -->
<!-- f.close() -->
<!-- newTable = bson.loads(data)   # convert BSON -> dictionary -->
<!-- len(newTable)   # 9001 entries -->
<!-- ``` -->
<!-- ```py -->
<!-- import numpy as np -->
<!-- c = np.random.rand(3, 3)   # 3x3 array drawn from a uniform [0,1) distribution -->
<!-- encode_array(array, traversal_stack, traversal_parent=None, generator_func=None, on_unknown=None) -->
<!-- ``` -->
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise Network
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>How would you store a network as a Python data structure?<br>
1. list of node coordinates<br>
2. list of connections, each with two node IDs<br>
3. optionally can wrap the previous two into a dictionary<br>
4. try to write it into a BSON file</p>
</div>
</div>
</div>
</section>
<section id="netcdf-and-hdf5" class="level2">
<h2 class="anchored" data-anchor-id="netcdf-and-hdf5">NetCDF (and HDF5)</h2>
<p>Previously, we saw that storing a large data array was very efficient with BSON (as far as file sizes are concerned), but we had to jump through a number of hoops:</p>
<ol type="1">
<li>put our array into a byte stream</li>
<li>use this byte stream as a value in a dictionary</li>
<li>convert this dictionary to BSON</li>
<li>write this BSON to disk</li>
</ol>
<p>There is a much better approach for large arrays: use a dedicated scientific array format library such as NetCDF or HDF5. These are available from (virtually) all programming languages. What they provide:</p>
<ol type="1">
<li>data description</li>
<li>data portability</li>
<li>data compression</li>
<li>multiple variables in a single file</li>
<li>multiple timesteps in a single file (if desired)</li>
<li>optionally, parallel I/O</li>
</ol>
<p>NetCDF and HDF5 are related to each other and heavily borrow from each other’s source code. There are some differences too, e.g.</p>
<ul>
<li>NetCDF has an ecosystem of conventions, e.g.&nbsp;a CF (climate-forecast) convention</li>
<li>NetCDF is understood natively by ParaView, HDF5 not so easily</li>
<li>HDF5 was developed specifically for storing hierarchical/nested data</li>
</ul>
<p>Here we only show NetCDF.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install netCDF4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> netCDF4 <span class="im">as</span> nc</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> nc.Dataset(<span class="st">"array.nc"</span>, <span class="st">'w'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'NETCDF4'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>f.createDimension(<span class="st">'x'</span>, <span class="dv">100</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>f.createDimension(<span class="st">'y'</span>, <span class="dv">100</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>f.createDimension(<span class="st">'z'</span>, <span class="dv">100</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>rho <span class="op">=</span> f.createVariable(<span class="st">'density'</span>, <span class="st">'f4'</span>, (<span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'z'</span>))   <span class="co"># f4 stands for 4-byte float</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>rho[:,:,:] <span class="op">=</span> np.random.random(size<span class="op">=</span>(<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">100</span>))</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>f.close()   <span class="co"># 4,008,192 bytes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now let’s read it:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> netCDF4 <span class="im">as</span> nc</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> nc.Dataset(<span class="st">"array.nc"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ds)  <span class="co"># can see the dimensions, variables, precision</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ds[<span class="st">"density"</span>].shape)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ds[<span class="st">"density"</span>][:])   <span class="co"># it is a numpy array</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise Compression 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Turn on compression when saving the variable. Did it change the file size?</p>
</div>
</div>
</div>
<!-- ```py -->
<!-- rho = f.createVariable('density', 'f4', ('x', 'y', 'z'), compression='szip') -->
<!-- ``` -->
<!-- Optionally can specify the level of compression, e.g. complevel=9 (highest). -->
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise Compression 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Read a highly compressed dataset from file <code>mandelbulb300.nc</code>. Compare the file size to the size of embedded data – do they agree? Give a reason behind that.</p>
</div>
</div>
</div>
<p>If you want the functionality of pandas (easy 2D table manipulation) in a multidimensional array, then you can use <code>xarray</code> Python library. Xarray library is built on top of numpy and pandas. There are two main data structures in xarray:</p>
<ul>
<li>xarray.DataArray is a fancy, labelled version of numpy.ndarray</li>
<li>xarray.Dataset is a collection of multiple xarray.DataArray’s that share dimensions</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install xarray</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xa</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> xa.DataArray(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    np.random.random(size<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>)),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>(<span class="st">"y"</span>,<span class="st">"x"</span>),  <span class="co"># dimension names (row,col); we want `y` to represent rows and `x` columns</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>{<span class="st">"x"</span>: [<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>], <span class="st">"y"</span>: [<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>]}  <span class="co"># coordinate labels/values</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can access various attributes of this array:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>data.values                 <span class="co"># the 2D numpy array</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>data.values[<span class="dv">0</span>,<span class="dv">0</span>] <span class="op">=</span> <span class="fl">0.53</span>     <span class="co"># can modify in-place</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>data.dims                   <span class="co"># ('y', 'x')</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>data.coords               <span class="co"># all coordinates, cannot modify!</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>data.coords[<span class="st">'x'</span>][<span class="dv">1</span>]       <span class="co"># a number</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>data.x[<span class="dv">1</span>]                 <span class="co"># the same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Array subsetting:</p>
<ul>
<li>isel() selects by index, could be replaced by [index1] or [index1,…]</li>
<li>sel() selects by value</li>
<li>interp() interpolates by value</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data.isel()      <span class="co"># same as `data`</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>data.isel(y<span class="op">=</span><span class="dv">1</span>)   <span class="co"># second row</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>data.isel(y<span class="op">=</span><span class="dv">0</span>, x<span class="op">=</span>[<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">1</span>])    <span class="co"># first row, last two columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vectorized operations:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">+</span> <span class="dv">100</span>      <span class="co"># element-wise like numpy arrays</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>(data <span class="op">-</span> data.mean()) <span class="op">/</span> data.std()    <span class="co"># normalize the data</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">-</span> data[<span class="dv">0</span>,:]      <span class="co"># use numpy broadcasting =&gt; subtract first row from all rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s initialize two 2D arrays with the identical dimensions:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> {<span class="st">"x"</span>: np.linspace(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">5</span>), <span class="st">"y"</span>: np.linspace(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">5</span>)}</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> xa.DataArray(      <span class="co"># first 2D array</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">20</span> <span class="op">+</span> np.random.randn(<span class="dv">5</span>,<span class="dv">5</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>(<span class="st">"y"</span>,<span class="st">"x"</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>coords</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>pres <span class="op">=</span> xa.DataArray(       <span class="co"># second 2D array</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="op">+</span> <span class="dv">10</span><span class="op">*</span>np.random.randn(<span class="dv">5</span>,<span class="dv">5</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    dims<span class="op">=</span>(<span class="st">"y"</span>,<span class="st">"x"</span>),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    coords<span class="op">=</span>coords</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From these we can form a dataset:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> xa.Dataset({<span class="st">"temperature"</span>: temp, <span class="st">"pressure"</span>: pres,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"bar"</span>: (<span class="st">"x"</span>, <span class="dv">200</span><span class="op">+</span>np.arange(<span class="dv">5</span>)), <span class="st">"pi"</span>: np.pi})</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Subsetting works the usual way:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ds.sel(x<span class="op">=</span><span class="dv">0</span>)     <span class="co"># each 2D array becomes 1D array, the 1D array becomes a number, plus a number</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ds.temperature.sel(x<span class="op">=</span><span class="dv">0</span>)     <span class="co"># 'temperature' is now a 1D array</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>ds.temperature.sel(x<span class="op">=</span><span class="fl">0.25</span>, y<span class="op">=</span><span class="fl">0.5</span>)     <span class="co"># one element of `temperature`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can save this dataset to a file:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ds.to_netcdf(<span class="st">"double.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Reading it is very easy:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>new <span class="op">=</span> xa.open_dataset(<span class="st">"double.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can even try opening this 2D dataset in ParaView - select (x,y) and deselect Spherical.</p>
<p>So far we’ve been working with datasets in Cartesian coordinates. How about spherical geometry – how do we initialize and store a dataset in spherical coordinates (longitude - latitude - elevation)? Very easy: define these coordinates and your data arrays on top, put everything into an xarray dataset, and then specify the following units:</p>
<pre><code>ds.lat.attrs["units"] = "degrees_north"   # this line is important to adhere to CF convention
ds.lon.attrs["units"] = "degrees_east"    # this line is important to adhere to CF convention</code></pre>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise NetCDF CF convention
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a <span class="math inline">\(100\times 300\)</span> (nlat<span class="math inline">\(\times\)</span>nlon) spherical dataset with two variables adhering to the NetCDF CF convention.</p>
</div>
</div>
</div>
<!-- ```py -->
<!-- import numpy as np -->
<!-- import xarray as xa -->
<!-- nlat, nlon = 100, 300 -->
<!-- coords = {"lat": np.linspace(-90,90,nlat), "lon": np.linspace(0,360,nlon)} -->
<!-- lat = np.linspace(-90,90,nlat) -->
<!-- lon = np.linspace(0,360,nlon).reshape(nlon,1) -->
<!-- temperature = np.cos(lat*np.pi/180) + np.sin(lon*np.pi/180) -->
<!-- temperature.shape          # (300,100) after broadcasting -->
<!-- temp = xa.DataArray(temperature, dims=("lon","lat"), coords=coords) -->
<!-- pres = xa.DataArray(100 + 10*np.random.randn(nlon,nlat), dims=("lon","lat"), coords=coords) -->
<!-- ds = xa.Dataset({"temperature": temp, "pressure": pres}) -->
<!-- ds.lat.attrs["units"] = "degrees_north"   # this line is important to adhere to CF convention -->
<!-- ds.lon.attrs["units"] = "degrees_east"    # this line is important to adhere to CF convention -->
<!-- ds.to_netcdf("climate.nc") -->
<!-- ``` -->
</section>
<section id="vtk-versatile-format-for-spatially-defined-data" class="level2">
<h2 class="anchored" data-anchor-id="vtk-versatile-format-for-spatially-defined-data">VTK = versatile format for spatially defined data</h2>
<p>VTK is a computer graphics and visualization library that’s been around since early 1990s. Originally it was C++ only, but now there are interfaces from other languages as well, including Python.</p>
<p><img src="./fig/vtkDataTypes.png" class="img-fluid"></p>
<ul>
<li>legacy VTK: ASCII or binary data, ASCII metadata, could write manually or through APIs</li>
<li>XML VTK: usually binary data, compression, parallel I/O, write via API</li>
</ul>
<p>In simple cases using the original VTK library is probably an overkill, as doing even simple things could involve quite a few function calls. VTK is a very powerful library, but there is also a very steep learning curve. Consider the number of functions inside VTK’s Python interface:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install vtk pyevtk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> vtk</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>[i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">dir</span>(vtk)]                    <span class="co"># returns 3593 functions</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>[i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">dir</span>(vtk) <span class="cf">if</span> <span class="st">"Writer"</span> <span class="kw">in</span> i]   <span class="co"># returns 104 functions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will see an example of using the original VTK library below. But first let us consider a simple example of writing data on a Cartesian mesh (<code>ImageData</code> in VTK speak). For this we can use a more lightweight library called <code>PyEVTK</code> which is dedicated library for exporting data stored in numpy arrays to VTK files.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyevtk.hl <span class="im">import</span> imageToVTK</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>nx, ny, nz <span class="op">=</span> <span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">30</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>ncells <span class="op">=</span> nx <span class="op">*</span> ny <span class="op">*</span> nz</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>npoints <span class="op">=</span> (nx<span class="op">+</span><span class="dv">1</span>) <span class="op">*</span> (ny<span class="op">+</span><span class="dv">1</span>) <span class="op">*</span> (nz<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>pressure <span class="op">=</span> np.random.rand(ncells).reshape((nx, ny, nz))      <span class="co"># double precision</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> np.random.rand(npoints).reshape((nx<span class="op">+</span><span class="dv">1</span>, ny<span class="op">+</span><span class="dv">1</span>, nz<span class="op">+</span><span class="dv">1</span>))   <span class="co"># double precision</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>imageToVTK(<span class="st">"image"</span>, cellData <span class="op">=</span> {<span class="st">"pressure"</span>: pressure}, pointData <span class="op">=</span> {<span class="st">"temp"</span>: temp})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Try loading this file into ParaView.</p>
<!-- more examples at https://vtk.org/Wiki/VTK/Writing_VTK_files_using_python -->
<p>Now let’s try writing a <code>StructuredGrid</code> dataset to a file:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyevtk.hl <span class="im">import</span> gridToVTK</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>nx, ny, nz <span class="op">=</span> <span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">30</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>xside, yside, zside <span class="op">=</span> <span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>ncells <span class="op">=</span> nx <span class="op">*</span> ny <span class="op">*</span> nz</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>npoints <span class="op">=</span> (nx<span class="op">+</span><span class="dv">1</span>) <span class="op">*</span> (ny<span class="op">+</span><span class="dv">1</span>) <span class="op">*</span> (nz<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.linspace(<span class="dv">0</span>, xside, nx<span class="op">+</span><span class="dv">1</span>, dtype<span class="op">=</span><span class="st">'float64'</span>)   <span class="co"># three coordinate axes</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.linspace(<span class="dv">0</span>, yside, ny<span class="op">+</span><span class="dv">1</span>, dtype<span class="op">=</span><span class="st">'float64'</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> np.linspace(<span class="dv">0</span>, zside, nz<span class="op">+</span><span class="dv">1</span>, dtype<span class="op">=</span><span class="st">'float64'</span>)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>x, y, z <span class="op">=</span> np.meshgrid(X,Y,Z)   <span class="co"># 3D coordinate arrays</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># perturb the grid to make it more interesting</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>x <span class="op">+=</span> (<span class="fl">0.5</span> <span class="op">-</span> np.random.random(npoints).reshape(nx<span class="op">+</span><span class="dv">1</span>,ny<span class="op">+</span><span class="dv">1</span>,nz<span class="op">+</span><span class="dv">1</span>)) <span class="op">*</span> <span class="fl">0.5</span> <span class="op">*</span> xside<span class="op">/</span>nx</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>y <span class="op">+=</span> (<span class="fl">0.5</span> <span class="op">-</span> np.random.random(npoints).reshape(nx<span class="op">+</span><span class="dv">1</span>,ny<span class="op">+</span><span class="dv">1</span>,nz<span class="op">+</span><span class="dv">1</span>)) <span class="op">*</span> <span class="fl">0.5</span> <span class="op">*</span> yside<span class="op">/</span>ny</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>z <span class="op">+=</span> (<span class="fl">0.5</span> <span class="op">-</span> np.random.random(npoints).reshape(nx<span class="op">+</span><span class="dv">1</span>,ny<span class="op">+</span><span class="dv">1</span>,nz<span class="op">+</span><span class="dv">1</span>)) <span class="op">*</span> <span class="fl">0.5</span> <span class="op">*</span> zside<span class="op">/</span>nz</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>pressure <span class="op">=</span> np.random.rand(ncells).reshape((nx, ny, nz))</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> np.random.rand(npoints).reshape((nx<span class="op">+</span><span class="dv">1</span>, ny<span class="op">+</span><span class="dv">1</span>, nz<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>gridToVTK(<span class="st">"structured"</span>, x, y, z, cellData <span class="op">=</span> {<span class="st">"pressure"</span> : pressure}, pointData <span class="op">=</span> {<span class="st">"temp"</span> : temp})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, here is the promised example with the original VTK library:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> writeNodesEdges <span class="im">import</span> writeObjects</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> nx.complete_bipartite_graph(<span class="dv">15</span>,<span class="dv">5</span>) <span class="co"># two sets of nodes</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nx.number_of_nodes(H), <span class="st">'nodes and'</span>, nx.number_of_edges(H), <span class="st">'edges'</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> nx.spring_layout(H,dim<span class="op">=</span><span class="dv">3</span>,k<span class="op">=</span><span class="dv">1</span>)   <span class="co"># dictionary of positions keyed by node</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>xyz <span class="op">=</span> [<span class="bu">list</span>(pos[i]) <span class="cf">for</span> i <span class="kw">in</span> pos]     <span class="co"># convert to a nested list of positions</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>degree <span class="op">=</span> [d <span class="cf">for</span> i,d <span class="kw">in</span> H.degree()]</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'degree ='</span>, degree)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>writeObjects(xyz, edges<span class="op">=</span>H.edges(), scalar<span class="op">=</span>degree, name<span class="op">=</span><span class="st">'degree'</span>, fileout<span class="op">=</span><span class="st">'network'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This wrote to a <code>PolygonalData</code> file. Try loading this file into ParaView and displaying the network with nodes and edges.</p>
<p>If you want to write to an <code>UnstructuredGrid</code> file, replace the last line with:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>writeObjects(xyz, edges<span class="op">=</span>H.edges(), scalar<span class="op">=</span>degree, name<span class="op">=</span><span class="st">'degree'</span>, fileout<span class="op">=</span><span class="st">'network'</span>, method <span class="op">=</span> <span class="st">'vtkUnstructuredGrid'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!-- writing a dictionary to CSV https://www.geeksforgeeks.org/working-csv-files-python -->
<!-- SQL - not for this workshop -->
<!-- "data serialization" -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/folio\.vastcloud\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>